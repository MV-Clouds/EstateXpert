<template>
    <template if:true={isLoading}>
        <c-spinner-component></c-spinner-component>
    </template>
    <template if:false={showLicenseError}>
        <div class="main-container">
            <!-- Header Section -->
            <div class="main_header_cls">
                <div class="sub_main_header_css">
                    <div class="header_block_css">
                        <div class="svg_back_icon" onclick={handleDiscard}>
                            <svg width="26" height="22" viewBox="0 0 30 26" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M28.3334 24.224C25.0711 20.2418 22.1742 17.9822 19.6427 17.4454C17.1111 16.9085 14.7009 16.8274 12.412 17.202V24.3334L1.66669 12.6967L12.412 1.66669V8.44469C16.6445 8.47802 20.2427 9.99646 23.2067 13C26.1702 16.0036 27.8791 19.7449 28.3334 24.224Z"
                                    fill="#131314" stroke="#131314" stroke-width="2" stroke-linejoin="round" />
                            </svg>
                        </div>
                        <div class="portal_mapping">
                            <template if:false={isEdit}>Create Flow</template>
                            <template if:true={isEdit}>
                                <div class="flow-info-header">
                                    <span class="flow-name-header">{flowName}</span>
                                    <!-- <div class="formatted-text1">
                                        <span class="segment one">{status}</span>
                                        <span class="dot">‚Ä¢</span>
                                        <span class="segment two">{formatDate}</span>
                                    </div> -->
                                </div>
                            </template>
                        </div>
                    </div>
                    <div class="header-actions">
                        <template if:false={isEdit}>
                            <button class="btn" onclick={handleCreate} disabled={isCreateDisabled}>
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14 8H8V14H6V8H0V6H6V0H8V6H14V8Z" fill="white" />
                                </svg>
                                Create
                            </button>
                        </template>
                        <template if:true={isEdit}>
                            <template if:true={isSaveEnabled}>
                                <button class="btn" onclick={onSaveClick}>Save</button>
                            </template>
                            <template if:true={isPublishedEnabled}>
                                <button class="btn" onclick={onPublishClick} disabled={disablePublish}>Publish</button>
                            </template>
                            <template if:true={isDeleteEnabled}>
                                <button class="btn btn-delete" onclick={onDeleteClick}>Delete</button>
                            </template>
                            <template if:true={isDeprecateEnabled}>
                                <button class="btn" onclick={onDeprecateClick}>Deprecate</button>
                            </template>
                        </template>
                    </div>
                </div>
            </div>

            <!-- Main Content Section -->
            <template if:false={isEdit}>
                <div class="content-wrapper">
                    <div class="divcontainer2">
                        <div class="createFlowDiv">
                            <div class="slds-box slds-theme_default templateContent3">
                                <div class="nameLan">
                                    <div class="namediv">
                                        <label for="flowName">Name</label>
                                        <input class="nameInput" type="text" id="flowName" name="flowName"
                                            value={flowName} maxlength="200" placeholder="Enter name"
                                            oninput={handleInputChange} />
                                        <p class="char-count tempname-count">{flowName.length}/{maxFlowNamelength}
                                        </p>
                                    </div>
                                </div>
                            </div>

                            <div class="slds-box slds-theme_default templateContent4">
                                <label for="flowName">Categories</label>
                                <div class="contentType">
                                    <c-custom-multiselect-picklist options={TypeOptions}
                                        onselectionchange={handleCatagories}></c-custom-multiselect-picklist>
                                </div>
                            </div>

                            <div class="slds-box slds-theme_default authContent1">
                                <div class="tempHead">
                                    <p class="content">Template</p>
                                </div>
                                <div class="radio-group">
                                    <div class="radio-item">
                                        <div class="radio">
                                            <lightning-input type="radio" class="radio-name" name="authMethod"
                                                value="Default" onchange={handleTypeChange}
                                                checked></lightning-input>
                                            <p class="radio-label">Default</p>
                                        </div>
                                    </div>
                                    <div class="radio-item">
                                        <div class="radio">
                                            <lightning-input type="radio" class="radio-name" name="authMethod"
                                                value="Collect purchase interest"
                                                onchange={handleTypeChange}></lightning-input>
                                            <p class="radio-label">Collect purchase interest</p>
                                        </div>
                                    </div>
                                    <div class="radio-item">
                                        <div class="radio">
                                            <lightning-input type="radio" class="radio-name" name="authMethod"
                                                value="Get feedback" onchange={handleTypeChange}></lightning-input>
                                            <p class="radio-label">Get feedback</p>
                                        </div>
                                    </div>
                                    <div class="radio-item">
                                        <div class="radio">
                                            <lightning-input type="radio" class="radio-name" name="authMethod"
                                                value="Send a survey" onchange={handleTypeChange}></lightning-input>
                                            <p class="radio-label">Send a survey</p>
                                        </div>
                                    </div>
                                    <div class="radio-item">
                                        <div class="radio">
                                            <lightning-input type="radio" class="radio-name" name="authMethod"
                                                value="Customer support"
                                                onchange={handleTypeChange}></lightning-input>
                                            <p class="radio-label">Customer support</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="flowPreviewDiv">
                        </div>
                    </div>
                </div>
            </template>
            <template if:true={isEdit}>
                <div class="content-wrapper">
                    <div class="edit-content">
                        <div class="editor-header">
                            <p class="editor-heading">Editor</p>
                            <button class="btn" onclick={onRunClick}>Run</button>
                        </div>
                        <div class="editor-container">
                            <div class="editor" lwc:dom="manual"></div>
                        </div>
                    </div>

                    <div class="preview-content">
                        <div class="preview-header">
                            <p class="preview-heading-text">Preview</p>
                        </div>
                        <div class="preview-container">
                            <c-wb-flow-preview flowname={flowName} jsonstringdata={jsonString}></c-wb-flow-preview>
                        </div>
                    </div>
                </div>
            </template>
            <template if:true={showPublishPopup}>
                <div class="backdrop" onclick={closePublishPopup}></div>
                <div class="popup">
                    <div class="popup-content">
                        <div class="left-section">
                            <img src={publishImageUrl} alt="Illustration" />
                        </div>
                        <div class="right-section">
                            <h2>You're about to publish this flow</h2>
                            <p>After this flow has been published, you can:</p>
                            <ul>
                                <li>üì§ Attach it to a message template to start engaging with your audience.
                                </li>
                                <li>‚úèÔ∏è Edit the content of the flow JSON and publish a new version.</li>
                            </ul>
                            <div class="button-group">
                                <button class="cancel" onclick={closePublishPopup}>Cancel</button>
                                <button class="publish" onclick={handlePublish}>Publish</button>
                            </div>
                        </div>
                    </div>
                </div>
            </template>

            <template if:true={showDeletePopup}>
                <div class="edit-backdrop" onclick={closeDeletePopup}></div>
                <div class="edit-popup">
                    <div class="edit-popup-content">
                        <h2 class="edit-popup-title">Are you sure you want to delete this flow?</h2>
                        <p class="edit-popup-text">
                            Once deleted, you won't be able to access this flow again. This cannot be undone.
                        </p>
                        <div class="edit-button-group">
                            <button class="edit-cancel-button" onclick={closeDeletePopup}>Cancel</button>
                            <button class="edit-delete-button" onclick={handleDelete}>Delete</button>
                        </div>
                    </div>
                </div>
            </template>

            <template if:true={showDeprecatePopup}>
                <div class="edit-backdrop" onclick={closeDeprecatePopup}></div>
                <div class="edit-popup">
                    <div class="edit-popup-content">
                        <h2 class="edit-popup-title">Are you sure you want to deprecate this flow?</h2>
                        <p class="edit-popup-text">
                            Once deprecated, you won't be able to revert. This cannot be undone.
                        </p>
                        <div class="edit-button-group">
                            <button class="edit-cancel-button" onclick={closeDeprecatePopup}>Cancel</button>
                            <button class="edit-delete-button" onclick={handleDeprecate}>Deprecate</button>
                        </div>
                    </div>
                </div>
            </template>
        </div>
    </template>
</template>