<template>
    <template if:true={isLoading}>
        <c-spinner-component></c-spinner-component>
    </template>
    <div class="wrapper">
        <div class="main_header_cls">
            <div class="sub_main_header_css">
                <div slot="title" class="header_block_css">
                    <div class="svg_back_icon" onclick={backToControlCenter}>
                        <svg width="26" height="22" viewBox="0 0 30 26" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path
                                d="M28.3334 24.224C25.0711 20.2418 22.1742 17.9822 19.6427 17.4454C17.1111 16.9085 14.7009 16.8274 12.412 17.202V24.3334L1.66669 12.6967L12.412 1.66669V8.44469C16.6445 8.47802 20.2427 9.99646 23.2067 13C26.1702 16.0036 27.8791 19.7449 28.3334 24.224Z"
                                fill="#131314" stroke="#131314" stroke-width="2" stroke-linejoin="round" />
                        </svg>
                    </div>
                    <div class="portal_mapping">
                        Map Listing And Inquiry
                    </div>
                </div>
            </div>
        </div>

        <div class="main_content_cls">
            <div class="slds-m-around_medium navbar">
                <div class="selected-condition">
                    <p><b>Condition Type</b>: {selectedConditionLabel} <template if:true={logicalConditionListing}>({logicalConditionListing})</template></p>
                </div>
                <div class="save-btn">
                    <button disabled={saveButtonDsibale} onclick={handleAddPairClick}>Save Mapping</button>
                    <button onclick={handleModalOpen} class="btn display_css2">
                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <path d="M14 8H8V14H6V8H0V6H6V0H8V6H14V8Z" fill="white" />
                        </svg>
                        Add Custom Logic
                    </button>
                </div>
            </div>

            <lightning-accordion allow-multiple-sections-open active-section-name={activeSections}>
                <lightning-accordion-section name="listingSection" label="Listing Mapping(For Suggested Listings on Inquiry Record Page)">

                    <template if:true={isListingdropDownAvaialble}>
                        <div class="table-content">
                            <table class="slds-table">
                                <thead>
                                    <tr class="table_tr_cls">
                                        <th scope="col" class="sno">
                                            <div class="font_css">No.</div>
                                        </th>
                                        <th scope="col" class="listing-field">
                                            <div class="font_css">Listing Field</div>
                                        </th>
                                        <th scope="col" class="condition">
                                            <div class="font_css">Condition</div>
                                        </th>
                                        <th scope="col" class="inquiry-field">
                                            <div class="font_css">Inquiry Field</div>
                                        </th>
                                        <th scope="col" class="actions">
                                            <div class="font_css">Action</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={listingDropDownPairsWithIndex} for:item="pair"
                                        for:index="index">
                                        <tr key={pair.Id}>
                                            <td data-label="S.No.">
                                                <div class="index-display">{pair.displayIndex}</div>
                                            </td>
                                            <td data-label="Status">
                                                <div class="flex-item">
                                                    <lightning-combobox label={pair.firstlabel}
                                                        options={pair.firstOptions} data-index={index}
                                                        value={pair.selectedFirst} data-object={listingObject}
                                                        onchange={handleFirstFieldChange}
                                                        variant="label-hidden"></lightning-combobox>
                                                </div>
                                            </td>
                                            <td data-label="Object Name">
                                                <div class="flex-item">
                                                    <lightning-combobox label="Condition"
                                                        options={pair.conditionsOptions} data-index={index}
                                                        value={pair.selectedCondition} onchange={handleConditionChange}
                                                        variant="label-hidden"
                                                        data-object={listingObject}></lightning-combobox>
                                                </div>
                                            </td>
                                            <td data-label="Template Type">
                                                <div class="flex-item">
                                                    <lightning-combobox label={pair.secondlabel}
                                                        options={pair.secondOptions} data-index={index}
                                                        value={pair.selectedSecond} data-object={listingObject}
                                                        onchange={handleSecondFieldChange}
                                                        variant="label-hidden"></lightning-combobox>
                                                </div>
                                            </td>
                                            <td data-label="Actions">
                                                <div class="action-btn">
                                                    <button class="delete-div" data-id={index} onclick={deletePair}
                                                        data-object={listingObject}>
                                                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                                            xmlns="http://www.w3.org/2000/svg">
                                                            <path
                                                                d="M2.62502 3.45834L3.32598 11.5194C3.40087 12.3807 4.12187 13.0417 4.98638 13.0417H9.01369C9.87819 13.0417 10.5992 12.3807 10.674 11.5194L11.375 3.45834M5.12502 3.25V2.625C5.12502 1.70453 5.87119 0.958336 6.79169 0.958336H7.20835C8.12885 0.958336 8.87502 1.70453 8.87502 2.625V3.25M1.16669 3.45834H12.8334"
                                                                stroke="#212529" stroke-width="1.25"
                                                                stroke-linecap="round" stroke-linejoin="round" />
                                                        </svg>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>

                        </div>
                    </template>

                    <template if:false={isListingdropDownAvaialble}>

                        <div class="no-data-available">
                            No Mapping Found
                        </div>
                    </template>


                    <div class="save-btn">
                        <button onclick={addNewPairlisting}>Add</button>
                        <div class="header">
                            <button class="add-btn btn display_css1" onclick={handleModalOpen}
                                data-object={listingObject}>
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14 8H8V14H6V8H0V6H6V0H8V6H14V8Z" fill="white" />
                                </svg>
                                Add Custom Logic
                            </button>
                        </div>
                    </div>
                </lightning-accordion-section>


                <div class="selected-condition custom-heading">
                    <p><b>Condition Type</b>: {selectedConditionLabelinquiry} <template if:true={logicalConditionInquiry}>({logicalConditionInquiry})</template></p>
                </div>

                <lightning-accordion-section name="inquirySection" label="Inquiry Mapping(For Suggested Inquiries on Listing Record Page)">
                    <div class="table-content">

                        <template if:true={isInquirydropDownAvailable}>
                            <table class="slds-table">
                                <thead>
                                    <tr class="table_tr_cls">
                                        <th scope="col" class="sno">
                                            <div class="font_css">No.</div>
                                        </th>
                                        <th scope="col" class="inquiry-field">
                                            <div class="font_css">Inquiry Field</div>
                                        </th>
                                        <th scope="col" class="condition">
                                            <div class="font_css">Condition</div>
                                        </th>
                                        <th scope="col" class="listing-field">
                                            <div class="font_css">Listing Field</div>
                                        </th>
                                        <th scope="col" class="actions">
                                            <div class="font_css">Action</div>
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <template for:each={inquiryDropDownPairsWithIndex} for:item="pair" for:index="index">
                                        <tr key={pair.Id}>
                                            <td data-label="S.No.">
                                                <div class="index-display">{pair.displayIndex}</div>
                                            </td>
                                            <td data-label="Status">
                                                <div class="flex-item">
                                                    <lightning-combobox label={pair.firstlabel} options={pair.firstOptions}
                                                        data-index={index} value={pair.selectedFirst}
                                                        data-object={inquiryObject} onchange={handleFirstFieldChange} dropdown-alignment="auto"
                                                        variant="label-hidden"></lightning-combobox>
                                                </div>
                                            </td>
                                            <td data-label="Object Name">
                                                <div class="flex-item">
                                                    <lightning-combobox label="Condition" options={pair.conditionsOptions}
                                                        data-index={index} value={pair.selectedCondition}
                                                        onchange={handleConditionChange} variant="label-hidden" dropdown-alignment="auto"
                                                        data-object={inquiryObject}></lightning-combobox>
                                                </div>
                                            </td>
                                            <td data-label="Template Type">
                                                <div class="flex-item">
                                                    <lightning-combobox label={pair.secondlabel}
                                                        options={pair.secondOptions} data-index={index}
                                                        value={pair.selectedSecond} data-object={inquiryObject}  dropdown-alignment="auto"
                                                        onchange={handleSecondFieldChange}
                                                        variant="label-hidden"></lightning-combobox>
                                                </div>
                                            </td>
                                            <td data-label="Actions">
                                                <div class="action-btn">
                                                    <button class="delete-div" data-id={index} onclick={deletePair}
                                                        data-object={inquiryObject}>
                                                        <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                                            xmlns="http://www.w3.org/2000/svg">
                                                            <path
                                                                d="M2.62502 3.45834L3.32598 11.5194C3.40087 12.3807 4.12187 13.0417 4.98638 13.0417H9.01369C9.87819 13.0417 10.5992 12.3807 10.674 11.5194L11.375 3.45834M5.12502 3.25V2.625C5.12502 1.70453 5.87119 0.958336 6.79169 0.958336H7.20835C8.12885 0.958336 8.87502 1.70453 8.87502 2.625V3.25M1.16669 3.45834H12.8334"
                                                                stroke="#212529" stroke-width="1.25" stroke-linecap="round"
                                                                stroke-linejoin="round" />
                                                        </svg>
                                                    </button>
                                                </div>
                                            </td>
                                        </tr>
                                    </template>
                                </tbody>
                            </table>
                        </template>


                    <template if:false={isInquirydropDownAvailable}>

                        <div class="no-data-available">
                            No Mapping Found
                        </div>
                    </template>

                    </div>

                    <div class="save-btn">
                        <button onclick={addNewPairInquiry}>Add</button>
                        <div class="header">
                            <button class="add-btn btn display_css1" onclick={handleModalOpen}
                                data-object={inquiryObject}>
                                <svg width="14" height="14" viewBox="0 0 14 14" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M14 8H8V14H6V8H0V6H6V0H8V6H14V8Z" fill="white" />
                                </svg>
                                Add Custom Logic
                            </button>
                        </div>
                    </div>
                </lightning-accordion-section>

            </lightning-accordion>

        </div>
    </div>

    <!-- Modal section -->
    <template if:true={showConfirmationModal}>
        <div class="slds-backdrop slds-backdrop_open"></div>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open">
            <div class="slds-modal__container">
                <div class="slds-modal__close closs_icon_css" onclick={closeConfirmationModal}>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M2.53317 19.3333L0.666504 17.4667L8.13317 9.99999L0.666504 2.53332L2.53317 0.666656L9.99984 8.13332L17.4665 0.666656L19.3332 2.53332L11.8665 9.99999L19.3332 17.4667L17.4665 19.3333L9.99984 11.8667L2.53317 19.3333Z"
                            fill="white" />
                    </svg>
                </div>

                <div class="slds-modal__header blue-header">
                    <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate" tabindex="-1">Confirmation</h1>
                </div>
                <div class="slds-modal__content slds-p-around_medium popdiv_cls" id="modal-content-id-1">
                    <p class="slds-text-align_center con-msg">Are you sure you want to save the changes?</p>
                    <div class="footer_css">
                        <button class="cancel_btn_css" onclick={closeConfirmationModal}>Cancel</button>
                        <button class="save_btn_css" onclick={handleConfirmAddPair}>Save</button>
                    </div>
                </div>
            </div>
        </section>
    </template>


    <template if:true={isModalOpen}>
        <div class="slds-backdrop slds-backdrop_open"></div>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
            <div class="slds-modal__container">
                <div class="slds-modal__close closs_icon_css" onclick={hideModalBox}>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M2.53317 19.3333L0.666504 17.4667L8.13317 9.99999L0.666504 2.53332L2.53317 0.666656L9.99984 8.13332L17.4665 0.666656L19.3332 2.53332L11.8665 9.99999L19.3332 17.4667L17.4665 19.3333L9.99984 11.8667L2.53317 19.3333Z"
                            fill="white" />
                    </svg>
                </div>

                <div class="slds-modal__header blue-header">
                    <h1 class="slds-modal__title slds-hyphenate" tabindex="-1">Filter Logic</h1>
                </div>
                <div class="slds-modal__content custom-modal-content" id="modal-content-id-2">
                    <div class="condition-container">

                        <template if:true={isModalListing}>
                            <div class="condition-container-item">
                                <lightning-combobox label="Select Condition Logic" value={selectedConditionTypeListing}
                                    placeholder="Select an option" options={conditionTypeOptions} data-name="listing"
                                    onchange={handleConditionTypeChange}>
                                </lightning-combobox>
                            </div>

                            <template if:true={isCustomLogicSelectedListing}>
                                <div class="condition-container-input">
                                    <lightning-input type="text" class="condition-input" label="Logical Expression"
                                        data-id="condition-input" value={logicalConditionListing} data-name="listing"
                                        onkeyup={handleConditionInputChange} placeholder="Example : 1 && 2"
                                        required></lightning-input>
                                    <template if:true={listingLogicError}>
                                        <div class="slds-text-color_error">{listingLogicError}</div>
                                    </template>
                                </div>
                            </template>

                            <div class="footer-btns">
                                <button class="cancel_btn_css" onclick={hideModalBox}>Cancel</button>
                                <template if:true={isCustomLogicSelectedListing}>
                                    <button class="save_btn_css" onclick={checkConditionSyntax}>Apply</button>
                                </template>
                                <template if:false={isCustomLogicSelectedListing}>
                                    <button class="save_btn_css" onclick={closeModalWithEnable}>Apply</button>
                                </template>
                            </div>
                        </template>

                        <template if:false={isModalListing}>

                            <div class="condition-container-item">
                                <lightning-combobox label="Select Condition Logic" value={selectedConditionTypeInquiry}
                                    placeholder="Select an option" options={conditionTypeOptions} data-name="inquiry"
                                    onchange={handleConditionTypeChange}>
                                </lightning-combobox>
                            </div>

                            <template if:true={isCustomLogicSelectedInquiry}>
                                <div class="condition-container-input">
                                    <lightning-input type="text" class="condition-input" label="Logical Expression"
                                        data-id="condition-input-2" value={logicalConditionInquiry} data-name="inquiry"
                                        onkeyup={handleConditionInputChange} placeholder="Example : 1 && 2"
                                        required></lightning-input>
                                    <template if:true={inquiryLogicError}>
                                        <div class="slds-text-color_error">{inquiryLogicError}</div>
                                    </template>
                                </div>
                            </template>

                            <div class="footer-btns">
                                <button class="cancel_btn_css" onclick={hideModalBox}>Cancel</button>
                                <template if:true={isCustomLogicSelectedInquiry}>
                                    <button class="save_btn_css" onclick={checkConditionSyntax}>Apply</button>
                                </template>
                                <template if:false={isCustomLogicSelectedInquiry}>
                                    <button class="save_btn_css" onclick={closeModalWithEnable}>Apply</button>
                                </template>
                            </div>
                        </template>


                    </div>
                </div>
            </div>
        </section>
    </template>

</template>