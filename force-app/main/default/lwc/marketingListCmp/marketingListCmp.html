<template>
    <template if:true={spinnerShow}>
        <c-spinner-component></c-spinner-component>
    </template>
    <div class="slds-grid slds-wrap slds-align_absolute-center full-page-container">
        <template if:true={isAccessible}>
            <div class="main">
                <div class="custom-header">
                    <div class="sub_main_header_css">
                        <div class="header_block_css">
                            Marketing List
                        </div>
                        <div class="header-buttons">
                            <button onclick={openConfigureSettings} class="icon-button">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path
                                        d="M12 15.5C10.07 15.5 8.5 13.93 8.5 12C8.5 10.07 10.07 8.5 12 8.5C13.93 8.5 15.5 10.07 15.5 12C15.5 13.93 13.93 15.5 12 15.5ZM19.43 12.97C19.47 12.65 19.5 12.33 19.5 12C19.5 11.67 19.47 11.34 19.43 11L21.54 9.37C21.73 9.22 21.78 8.95 21.66 8.73L19.66 5.27C19.54 5.05 19.27 4.96 19.05 5.05L16.56 6.05C16.04 5.66 15.5 5.32 14.87 5.07L14.5 2.42C14.46 2.18 14.25 2 14 2H10C9.75 2 9.54 2.18 9.5 2.42L9.13 5.07C8.5 5.32 7.96 5.67 7.44 6.05L4.95 5.05C4.73 4.96 4.46 5.05 4.34 5.27L2.34 8.73C2.21 8.95 2.27 9.22 2.46 9.37L4.57 11C4.53 11.34 4.5 11.67 4.5 12C4.5 12.33 4.53 12.65 4.57 12.97L2.46 14.63C2.27 14.78 2.21 15.05 2.34 15.27L4.34 18.73C4.46 18.95 4.73 19.03 4.95 18.95L7.44 17.94C7.96 18.34 8.5 18.68 9.13 18.93L9.5 21.58C9.54 21.82 9.75 22 10 22H14C14.25 22 14.46 21.82 14.5 21.58L14.87 18.93C15.5 18.67 16.04 18.33 16.56 17.94L19.05 18.95C19.27 19.03 19.54 18.95 19.66 18.73L21.66 15.27C21.78 15.05 21.73 14.78 21.54 14.63L19.43 12.97Z"
                                        fill="white" />
                                </svg>
                                Configure Settings
                            </button>
                            <template if:true={isConfigOpen}>
                                <c-record-config-body-cmp feature-name="Marketing List"
                                    onclose={handleCloseModal}></c-record-config-body-cmp>
                            </template>
                            <template if:true={hasBusinessAccountConfigured}>
                                <button onclick={handleSendMessage} class="icon-button"
                                    disabled={isContactSelected}>
                                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z" fill="white"/>
                                    </svg>
                                    Send Message
                                </button>
                            </template>
                            <button onclick={handleAdd} class="icon-button">
                                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M20 4H4C2.9 4 2.01 4.9 2.01 6L2 18C2 19.1 2.9 20 4 20H20C21.1 20 22 19.1 22 18V6C22 4.9 21.1 4 20 4ZM20 8L12 13L4 8V6L12 11L20 6V8Z" fill="white"/>
                                </svg>
                                Send Emails
                            </button>
                            <button onclick={goTOContactPage} class="icon-button">
                                <svg width="12" height="12" viewBox="0 0 12 12" fill="none"
                                    xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 6.75H6.75V12H5.25V6.75H0V5.25H5.25V0H6.75V5.25H12V6.75Z"
                                        fill="white" />
                                </svg>
                                New Contact
                            </button>
                        </div>
                    </div>
                    <div class="second-row">
                        <div class="meta-text">
                            <template if:false={isSelected}>
                                <span class="count-badge">{totalContacts} {contactItems}</span>
                            </template>
                            <template if:true={isSelected}>
                                <span class="count-badge selected-badge">{totalSelected} {items} Selected</span>
                            </template>
                        </div>
                        <div class="filter-tab-btns">
                            <div class="tab-section">
                                <div class="sort-desc">
                                    <div class="sort-icon">
                                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M10 14H2M8 10H2M6 6H2M12 18H2M19 20V4M19 20L22 17M19 20L16 17M19 4L22 7M19 4L16 7"
                                                stroke="#0176D3" stroke-width="1.5" stroke-linecap="round"
                                                stroke-linejoin="round" />
                                        </svg>
                                    </div>
                                    <div class="sort-text">{sortDescription}</div>
                                </div>
                                
                                <div class="tab-btns">
                                    <ul>
                                        <li class="tab-div active-tab-div" onclick={handleMenuTabClick} data-tab-id="1">
                                            <svg class="activeSvg menusvg" width="16" height="12" viewBox="0 0 24 14"
                                                fill="none" xmlns="http://www.w3.org/2000/svg">
                                                <path data-tab-index="1"
                                                    d="M0 8.33337H2.66667V5.66671H0V8.33337ZM0 13.6667H2.66667V11H0V13.6667ZM0 3.00004H2.66667V0.333374H0V3.00004ZM5.33333 8.33337H24V5.66671H5.33333V8.33337ZM5.33333 13.6667H24V11H5.33333V13.6667ZM5.33333 0.333374V3.00004H24V0.333374H5.33333ZM0 8.33337H2.66667V5.66671H0V8.33337ZM0 13.6667H2.66667V11H0V13.6667ZM0 3.00004H2.66667V0.333374H0V3.00004ZM5.33333 8.33337H24V5.66671H5.33333V8.33337ZM5.33333 13.6667H24V11H5.33333V13.6667ZM5.33333 0.333374V3.00004H24V0.333374H5.33333Z"
                                                    fill="#131314" />
                                            </svg>
                                        </li>
                                        <li class="tab-div" onclick={handleMenuTabClick} data-tab-id="2">
                                            <svg class="menusvg" width="24" height="24" viewBox="0 0 24 24" fill="none"
                                                xmlns="http://www.w3.org/2000/svg">
                                                <path data-tab-index="2" fill-rule="evenodd" clip-rule="evenodd"
                                                    d="M8 13.3333C8.70724 13.3333 9.38552 13.6143 9.88562 14.1144C10.3857 14.6145 10.6667 15.2928 10.6667 16V21.3333C10.6667 22.0406 10.3857 22.7189 9.88562 23.219C9.38552 23.719 8.70724 24 8 24H2.66667C1.95942 24 1.28115 23.719 0.781048 23.219C0.280951 22.7189 0 22.0406 0 21.3333V16C0 15.2928 0.280951 14.6145 0.781048 14.1144C1.28115 13.6143 1.95942 13.3333 2.66667 13.3333H8ZM21.3333 13.3333C22.0406 13.3333 22.7189 13.6143 23.219 14.1144C23.719 14.6145 24 15.2928 24 16V21.3333C24 22.0406 23.719 22.7189 23.219 23.219C22.7189 23.719 22.0406 24 21.3333 24H16C15.2928 24 14.6145 23.719 14.1144 23.219C13.6143 22.7189 13.3333 22.0406 13.3333 21.3333V16C13.3333 15.2928 13.6143 14.6145 14.1144 14.1144C14.6145 13.6143 15.2928 13.3333 16 13.3333H21.3333ZM8 0C8.70724 0 9.38552 0.280951 9.88562 0.781048C10.3857 1.28115 10.6667 1.95942 10.6667 2.66667V8C10.6667 8.70724 10.3857 9.38552 9.88562 9.88562C9.38552 10.3857 8.70724 10.6667 8 10.6667H2.66667C1.95942 10.6667 1.28115 10.3857 0.781048 9.88562C0.280951 9.38552 0 8.70724 0 8V2.66667C0 1.95942 0.280951 1.28115 0.781048 0.781048C1.28115 0.280951 1.95942 0 2.66667 0H8ZM21.3333 0C22.0406 0 22.7189 0.280951 23.219 0.781048C23.719 1.28115 24 1.95942 24 2.66667V8C24 8.70724 23.719 9.38552 23.219 9.88562C22.7189 10.3857 22.0406 10.6667 21.3333 10.6667H16C15.2928 10.6667 14.6145 10.3857 14.1144 9.88562C13.6143 9.38552 13.3333 8.70724 13.3333 8V2.66667C13.3333 1.95942 13.6143 1.28115 14.1144 0.781048C14.6145 0.280951 15.2928 0 16 0H21.3333Z"
                                                    fill="white" />
                                            </svg>
                                        </li>
                                    </ul>
                                </div>
                                <div class="filter-tab-wrapper">
                                    <div class="filter-toggle-btn" onclick={wrapFilter}>
                                        <svg class="filter-icon" width="16" height="16" viewBox="0 0 16 16" fill="none"
                                            xmlns="http://www.w3.org/2000/svg">
                                            <path
                                                d="M7.9996 0.999999L7.9996 10.3497M7.9996 13.6499L7.9996 15M7.9996 13.6499C7.53904 13.6499 7.09734 13.4761 6.77167 13.1668C6.446 12.8574 6.26304 12.4378 6.26304 12.0002C6.26304 11.5627 6.446 11.1431 6.77167 10.8337C7.09734 10.5243 7.53904 10.3505 7.9996 10.3505C8.46016 10.3505 8.90186 10.5243 9.22753 10.8337C9.5532 11.1431 9.73616 11.5627 9.73616 12.0002C9.73616 12.4378 9.5532 12.8574 9.22753 13.1668C8.90186 13.4761 8.46016 13.6499 7.9996 13.6499ZM13.2626 0.999999L13.2626 5.34984M13.2626 5.34984C13.7233 5.34984 14.1655 5.52407 14.4913 5.83352C14.817 6.14298 15 6.56269 15 7.00032C15 7.43786 14.8162 7.85747 14.4906 8.16686C14.1649 8.47624 13.7232 8.65005 13.2626 8.65005M13.2626 5.34984C12.802 5.34984 12.3606 5.52407 12.0348 5.83352C11.7091 6.14298 11.5261 6.56269 11.5261 7.00032C11.5261 7.43786 11.709 7.85747 12.0347 8.16686C12.3604 8.47624 12.8021 8.65005 13.2626 8.65005M13.2626 8.65005L13.2626 15M2.73656 0.999999L2.73656 3.34973M2.73656 6.64995L2.73656 15M2.73656 6.64995C2.27599 6.64995 1.83429 6.47614 1.50863 6.16675C1.18296 5.85737 1 5.43775 1 5.00022C1 4.78357 1.04492 4.56905 1.13219 4.36889C1.21946 4.16874 1.34737 3.98687 1.50863 3.83368C1.66988 3.68049 1.86132 3.55897 2.07201 3.47606C2.28269 3.39316 2.50851 3.35049 2.73656 3.35049C2.96461 3.35049 3.19042 3.39316 3.40111 3.47606C3.6118 3.55897 3.80323 3.68049 3.96449 3.83368C4.12574 3.98687 4.25366 4.16874 4.34093 4.36889C4.4282 4.56905 4.47311 4.78357 4.47311 5.00022C4.47311 5.43775 4.29016 5.85737 3.96449 6.16675C3.63882 6.47614 3.19712 6.64995 2.73656 6.64995Z"
                                                stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <template if:true={mobileView}>
                    <div class="wrap-mobile">
                        <div>Filter</div>
                        <div class="svg-cover" onclick={wrapFilter}>
                            <svg width="16" height="16" viewBox="0 0 16 16" fill="none"
                                xmlns="http://www.w3.org/2000/svg">
                                <path
                                    d="M7.9996 0.999999L7.9996 10.3497M7.9996 13.6499L7.9996 15M7.9996 13.6499C7.53904 13.6499 7.09734 13.4761 6.77167 13.1668C6.446 12.8574 6.26304 12.4378 6.26304 12.0002C6.26304 11.5627 6.446 11.1431 6.77167 10.8337C7.09734 10.5243 7.53904 10.3505 7.9996 10.3505C8.46016 10.3505 8.90186 10.5243 9.22753 10.8337C9.5532 11.1431 9.73616 11.5627 9.73616 12.0002C9.73616 12.4378 9.5532 12.8574 9.22753 13.1668C8.90186 13.4761 8.46016 13.6499 7.9996 13.6499ZM13.2626 0.999999L13.2626 5.34984M13.2626 5.34984C13.7233 5.34984 14.1655 5.52407 14.4913 5.83352C14.817 6.14298 15 6.56269 15 7.00032C15 7.43786 14.8162 7.85747 14.4906 8.16686C14.1649 8.47624 13.7232 8.65005 13.2626 8.65005M13.2626 5.34984C12.802 5.34984 12.3606 5.52407 12.0348 5.83352C11.7091 6.14298 11.5261 6.56269 11.5261 7.00032C11.5261 7.43786 11.709 7.85747 12.0347 8.16686C12.3604 8.47624 12.8021 8.65005 13.2626 8.65005M13.2626 8.65005L13.2626 15M2.73656 0.999999L2.73656 3.34973M2.73656 6.64995L2.73656 15M2.73656 6.64995C2.27599 6.64995 1.83429 6.47614 1.50863 6.16675C1.18296 5.85737 1 5.43775 1 5.00022C1 4.78357 1.04492 4.56905 1.13219 4.36889C1.21946 4.16874 1.34737 3.98687 1.50863 3.83368C1.66988 3.68049 1.86132 3.55897 2.07201 3.47606C2.28269 3.39316 2.50851 3.35049 2.73656 3.35049C2.96461 3.35049 3.19042 3.39316 3.40111 3.47606C3.6118 3.55897 3.80323 3.68049 3.96449 3.83368C4.12574 3.98687 4.25366 4.16874 4.34093 4.36889C4.4282 4.56905 4.47311 4.78357 4.47311 5.00022C4.47311 5.43775 4.29016 5.85737 3.96449 6.16675C3.63882 6.47614 3.19712 6.64995 2.73656 6.64995Z"
                                    stroke="white" stroke-width="1.5" stroke-miterlimit="10" stroke-linecap="round" />
                            </svg>
                        </div>
                    </div>
                </template>
                <template if:false={mobileAddModal}>
                    <div class="body">
                        <template if:false={fieldsModal}>
                            <div class="innerDiv2 main_content_cls">
                            <template if:true={listingSpinnerLoading}>
                                <c-spinner-component is-absolute="true"></c-spinner-component>
                            </template>
                                <template if:true={showList}>
                                    <template if:false={showSection}>
                                        <div class="tableDiv" id="tableDiv">
                                            <table aria-multiselectable="true"
                                                class="slds-table slds-table_fixed-layout slds-table_resizable-cols"
                                                role="grid"
                                                aria-label="Example advanced table of Opportunities in actionable mode">
                                                <thead>
                                                    <tr class="slds-line-height_reset fields-names">
                                                        <th class="slds-text-align_right slds-cell_action-mode colume1"
                                                            scope="col">
                                                            <span id="column-group-header"
                                                                class="slds-assistive-text">Choose a row</span>
                                                            <div class="header-checkbox-div">
                                                                <label class="custom-checkbox">
                                                                    <input type="checkbox" onchange={selectAllCheckbox}
                                                                        checked={checkAll}>
                                                                    <span class="checkmark"></span>
                                                                </label>
                                                            </div>
                                                        </th>
                                                        <th aria-sort="none" data-id="Name" onclick={sortClick}
                                                            class="slds-is-resizable slds-is-sortable slds-cell_action-mode colume2"
                                                            scope="col">
                                                            <div class="slds-text-link_reset sort-cover" role="button"
                                                                tabindex="0">
                                                                <span class="slds-assistive-text">Sort by: </span>
                                                                <div
                                                                    class="slds-has-flexi-truncate center-trancate-head">
                                                                    <span class="slds-truncate" title="Title">Contact
                                                                        Name</span>
                                                                    <span
                                                                        class="slds-icon_container slds-icon-utility-arrowdown">
                                                                        <svg data-index="Name" class="listing-manager-icon"
                                                                            viewBox="0 0 384 512"
                                                                            xmlns="http://www.w3.org/2000/svg">
                                                                            <path
                                                                                d="M374.6 246.6C368.4 252.9 360.2 256 352 256s-16.38-3.125-22.62-9.375L224 141.3V448c0 17.69-14.33 31.1-31.1 31.1S160 465.7 160 448V141.3L54.63 246.6c-12.5 12.5-32.75 12.5-45.25 0s-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0l160 160C387.1 213.9 387.1 234.1 374.6 246.6z" />
                                                                        </svg>
                                                                    </span>
                                                                </div>
                                                            </div>
                                                        </th>
                                                        <template for:each={fields} for:item="contact"
                                                            for:index="index">
                                                            <th key={contact.fieldName} data-id={contact.fieldName}
                                                                onclick={sortClick} aria-sort="none"
                                                                class="slds-is-resizable slds-is-sortable slds-cell_action-mode colume2"
                                                                scope="col">
                                                                <div class="slds-text-link_reset sort-cover"
                                                                    role="button" tabindex="0">
                                                                    <span class="slds-assistive-text">Sort by: </span>
                                                                    <div
                                                                        class="slds-has-flexi-truncate center-trancate-head">
                                                                        <span class="slds-truncate"
                                                                            title="Title">{contact.fieldLabel}</span>
                                                                        <span
                                                                            class="slds-icon_container slds-icon-utility-arrowdown">
                                                                            <svg data-index={contact.fieldName}
                                                                                class="listing-manager-icon"
                                                                                viewBox="0 0 384 512"
                                                                                xmlns="http://www.w3.org/2000/svg">
                                                                                <path
                                                                                    d="M374.6 246.6C368.4 252.9 360.2 256 352 256s-16.38-3.125-22.62-9.375L224 141.3V448c0 17.69-14.33 31.1-31.1 31.1S160 465.7 160 448V141.3L54.63 246.6c-12.5 12.5-32.75 12.5-45.25 0s-12.5-32.75 0-45.25l160-160c12.5-12.5 32.75-12.5 45.25 0l160 160C387.1 213.9 387.1 234.1 374.6 246.6z" />
                                                                            </svg>
                                                                        </span>
                                                                    </div>
                                                                </div>
                                                            </th>
                                                        </template>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template for:each={shownProcessedContactData} for:item="contact"
                                                        for:index="index">
                                                        <tr key={contact.Id} aria-selected="false" class="table-tr">
                                                            <td class="slds-text-align_right slds-cell_action-mode checkbox-cell"
                                                                role="gridcell">
                                                                <label class="custom-checkbox custom-checkbox-body">
                                                                    <input data-id={index} type="checkbox"
                                                                        checked={contact.isChecked}
                                                                        value={contact.isChecked}
                                                                        onchange={checkBoxValueChange}>
                                                                    <span class="checkmark"></span>
                                                                </label>
                                                            </td>
                                                            <th class="slds-cell_action-mode conat_cls" scope="row">
                                                                <div class="slds-truncate center-trancate-text">
                                                                    <a data-id={contact.Id} onclick={redirectToRecord}
                                                                        tabindex="0">{contact.Name}</a>
                                                                </div>
                                                            </th>
                                                            <template for:each={contact.orderedFields} for:item="field"
                                                                for:index="index2">
                                                                <td key={field.fieldName} class="slds-cell_action-mode"
                                                                    role="gridcell">
                                                                    <div class="slds-truncate center-trancate-text">
                                                                        {field.value}
                                                                    </div>
                                                                </td>
                                                            </template>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </template>
                                    <template if:true={showSection}>
                                        <div class="noresult">
                                            <div class="noresult-class">
                                                <p class="tag1">No Result found yet...</p>
                                                <p class="tag2">We did not find any result for your search</p>
                                            </div>
                                        </div>
                                    </template>
                                    <div class="paginationDiv slds-var-p-around_medium">
                                        <div class="btnCover">
                                            <div class="pagination-container">
                                                <button class="pagination-button" disabled={isFirstPage}
                                                    onclick={handlePrevious}>
                                                    <svg xmlns="http://www.w3.org/2000/svg" height="52" width="52"
                                                        viewBox="0 0 520 520" fill="#fff">
                                                        <path
                                                            d="M342 477 134 272c-6-6-6-16 0-22L342 45c6-6 16-6 22 0l22 22c6 6 6 16 0 22L221 250c-6 6-6 16 0 22l163 161c6 6 6 16 0 22l-22 22c-5 5-14 5-20 0z" />
                                                    </svg>
                                                    Previous
                                                </button>

                                                <template for:each={pageNumbers} for:item="page">
                                                    <template if:false={page.isEllipsis}>
                                                        <button key={page.number} data-id={page.number}
                                                            class={page.className} onclick={handlePageChange}>
                                                            {page.number}
                                                        </button>
                                                    </template>
                                                    <template if:true={page.isEllipsis}>
                                                        <span key={page.number} class="pagination-ellipsis">...</span>
                                                    </template>
                                                </template>

                                                <button class="pagination-button" disabled={isLastPage}
                                                    onclick={handleNext}>
                                                    Next
                                                    <svg xmlns="http://www.w3.org/2000/svg" height="52" width="52"
                                                        viewBox="0 0 520 520" fill="#fff">
                                                        <path
                                                            d="m179 44 207 205c6 6 6 16 0 22L179 476c-6 6-16 6-22 0l-22-22c-6-6-6-16 0-22l163-161c6-6 6-16 0-22L136 88c-6-6-6-16 0-22l22-22c6-5 15-5 21 0z" />
                                                    </svg>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </template>
                                <template if:true={showTile}>
                                    <c-marketing-list-tile-view onvalueselected={handleContactSelect}
                                        contactsdata={processedContactData} pagesize={pageSize}>
                                    </c-marketing-list-tile-view>
                                </template>
                            </div>
                        </template>
                        <div class="innerDiv1">
                            <div class="filterDiv">
                                <c-marketing-list-filter-cmp class="marketing-list-cmp"
                                    onvalueselected={handleFilteredContacts} onmodalvaluechange={handlAddModalChange}
                                    onvaluereset={handleReset} onloading={handleLoading}>
                                </c-marketing-list-filter-cmp>
                            </div>
                        </div>
                    </div>
                </template>
            </div>
        </template>
        <template if:false={isAccessible}>
            <div class="restricted-access">
                <svg viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path
                        d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"
                        fill="currentColor" />
                </svg>
                <h1>Access Restricted</h1>
                <p>You don't have permission to access this page. Please contact your administrator for further
                    assistance.</p>
            </div>
        </template>
    </div>
    <template if:true={addModal}>
        <section role="dialog" tabindex="-1" aria-labelledby="modal-heading-01" aria-modal="true"
            aria-describedby="modal-content-id-1" class="slds-modal slds-fade-in-open slds-modal_small">
            <div class="slds-modal__container">
                <!-- Modal/Popup Header -->
                <div class="slds-modal__close closs_icon_css" onclick={handleClose}>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M2.53317 19.3333L0.666504 17.4667L8.13317 9.99999L0.666504 2.53332L2.53317 0.666656L9.99984 8.13332L17.4665 0.666656L19.3332 2.53332L11.8665 9.99999L19.3332 17.4667L17.4665 19.3333L9.99984 11.8667L2.53317 19.3333Z"
                            fill="white" />
                    </svg>
                </div>

                <div class="slds-modal__header blue-header">
                    <h1 class="slds-modal__title slds-hyphenate" tabindex="-1">New Contact</h1>
                </div>
                <!-- Modal/Popup Body -->
                <div class="slds-modal__content slds-p-around_medium custom-modal-content">
                    <slot>
                        <lightning-card title="Contact Details" icon-name="standard:contact">
                            <template if:true={mobileView}>
                                <lightning-record-form record-id={recordId} object-api-name="Contact" layout-type="Full"
                                    mode="edit" columns="1" onsubmit={newContactHandle} oncancel={cancelRecordForm}>
                                </lightning-record-form>
                            </template>
                            <template if:false={mobileView}>
                                <lightning-record-form record-id={recordId} object-api-name="Contact" layout-type="Full"
                                    mode="edit" columns="2" onsubmit={newContactHandle} oncancel={cancelRecordForm}>
                                </lightning-record-form>
                            </template>
                        </lightning-card>
                    </slot>
                </div>
            </div>
        </section>
        <div class="slds-backdrop slds-backdrop_open"></div>
    </template>

    <!-- <c-email-campaign-modal if:true={isModalOpen} onclose={handleModalClose} selected-contacts={selectedContactList}>
    </c-email-campaign-modal> -->

    <c-send-emails if:true={isModalOpen} onclose={handleModalClose} show-modal={isModalOpen}
        object-api-name={objectName} selected-contacts={selectedContactList}>
    </c-send-emails>

    <template if:true={showTemplate}>
        <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
            class="slds-modal slds-fade-in-open slds-modal_small">
            <div class="slds-modal__container send-template-modal-container">
                <div class="slds-modal__close closs_icon_css" onclick={handleCloseTemplate}>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M2.53317 19.3333L0.666504 17.4667L8.13317 9.99999L0.666504 2.53332L2.53317 0.666656L9.99984 8.13332L17.4665 0.666656L19.3332 2.53332L11.8665 9.99999L19.3332 17.4667L17.4665 19.3333L9.99984 11.8667L2.53317 19.3333Z"
                            fill="white" />
                    </svg>
                </div>

                <div class="slds-modal__header blue-header">
                    <h1 class="slds-modal__title slds-hyphenate" tabindex="-1">{popupHeader}</h1>
                </div>

                <div class="modal-body">
                    <div class="custom-modal-body" id="modal-content-id-1">                       
                        <!-- First Page: Template Selection with Contact List and Preview -->
                        <template if:true={popUpFirstPage}>
                            <div class="secondPage">
                                <div class="template-selector-section">
                                    <div class="template-selector-wrapper">
                                        <lightning-combobox name="template" label="Select Template"
                                            options={templateOptions} onchange={handleInputChange}
                                            value={selectedTemplate} required
                                            message-when-value-missing="Template is required"
                                            class="template-combobox">
                                        </lightning-combobox>
                                    </div>

                                    <div class="template-prev">
                                    <div class="preview-box-container">
                                        <template if:true={selectedTemplate}>
                                            <div class="preview-box">
                                                <c-template-preview 
                                                    template-id={selectedTemplate} 
                                                    record-id={previewRecordId}
                                                    object-api-name={selectedObject}>
                                                </c-template-preview>
                                            </div>
                                        </template>
                                        <template if:false={selectedTemplate}>
                                            <div class="preview-placeholder">
                                                Please select a template to preview.
                                            </div>
                                        </template>
                                    </div>
                                    </div>
                                </div>

                                <div class="preview-section-right">
                                    <lightning-input 
                                        type="search"
                                        label="Search contacts"
                                        variant="label-hidden"
                                        placeholder="Search by name or phone"
                                        onchange={handleSearch}
                                        data-id="search-input"
                                        class="contact-search">
                                    </lightning-input>

                                    <div class="selected-contacts-section">
                                        <!-- <p class="contacts-table-label">Selected Contacts</p> -->
                                        <div class="contacts-table-wrapper">
                                            <table class="contacts-table">
                                                <thead>
                                                    <tr>
                                                        <th>Name</th>
                                                        <th>Phone</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <template if:true={filteredSelectedContacts.length}>
                                                        <template for:each={filteredSelectedContacts} for:item="contact" for:index="index">
                                                            <tr key={contact.Id}>
                                                                <td>{contact.Name}</td>
                                                                <td>{contact.Phone}</td>
                                                                <td>
                                                                    <lightning-button-icon 
                                                                        icon-name="utility:delete" 
                                                                        alternative-text="Remove" 
                                                                        title="Remove" 
                                                                        variant="bare" 
                                                                        size="small"
                                                                        onclick={handleRemoveContact}
                                                                        data-id={contact.Id}
                                                                        data-index={index}>
                                                                    </lightning-button-icon>
                                                                </td>
                                                            </tr>
                                                        </template>
                                                    </template>
                                                    <template if:false={filteredSelectedContacts.length}>
                                                        <tr>
                                                            <td colspan="3" class="no-results-cell">
                                                                <div class="no-results-container">
                                                                    <lightning-icon icon-name="utility:search" size="small"></lightning-icon>
                                                                    <span>No matching contacts found</span>
                                                                </div>
                                                            </td>
                                                        </tr>
                                                    </template>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="popUpFooter slds-text-align--center">
                                <lightning-button variant="brand" label="Send" onclick={handleConfirmPopup}
                                    class="slds-m-left_x-small"></lightning-button>
                                <lightning-button variant="brand" label="Schedule" onclick={handleSchedulePopup}
                                    class="slds-m-left_x-small"></lightning-button>
                            </div>
                        </template>
                    </div>
                </div>
            </div>
        </section>
         <!-- Backdrop for main modal -->
    <div class="slds-backdrop slds-backdrop_open main-modal-backdrop"></div>

    <!-- Schedule Modal -->
    <template if:true={popUpLastPage}>
        <div class="slds-backdrop slds-backdrop_open schedule-modal-backdrop" onclick={handleBackdropClick}></div>
        
        <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="datetime-modal-heading"
            class="slds-modal slds-fade-in-open schedule-modal"
            aria-describedby="modal-content-id-2">
            <div class="slds-modal__container schedule-modal-container">
                <div class="slds-modal__close schedule-close-icon" onclick={handlePreviousLastPage}>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M2.53317 19.3333L0.666504 17.4667L8.13317 9.99999L0.666504 2.53332L2.53317 0.666656L9.99984 8.13332L17.4665 0.666656L19.3332 2.53332L11.8665 9.99999L19.3332 17.4667L17.4665 19.3333L9.99984 11.8667L2.53317 19.3333Z"
                            fill="white" />
                    </svg>
                </div>

                <div class="slds-modal__header schedule-modal-header">
                    <h2 class="slds-modal__title" id="datetime-modal-heading">Schedule Date & Time</h2>
                </div>

                <div class="slds-modal__content schedule-modal-content" id="modal-content-id-2">
                    <div class="datetime-selection-wrapper">
                        
                        <div class="timezone-note">
                            <svg class="w-6 h-6 text-gray-800 dark:text-white cal-icon" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 10h16M8 14h8m-4-7V4M7 7V4m10 3V4M5 20h14a1 1 0 0 0 1-1V7a1 1 0 0 0-1-1H5a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1Z"/>
                                </svg>
                                <div class="schedule-message">
                                    <p class="main-line">Schedule your message</p>
                                    <p class="next-line">Choose when to send the template.</p>
                                </div>
                        </div>
                        <lightning-input type="datetime-local" 
                            name="scheduleDateTime" 
                            label="Select Date and Time"
                            value={selectedDateTime}
                            onchange={handleInputChange}
                            required
                            message-when-value-missing="Please select a date and time"
                            variant="label-stacked">
                        </lightning-input>
                        
                    </div>

                    <div class="schedule-modal-footer slds-text-align--center">
                                <lightning-button variant="neutral" 
                        label="Cancel" 
                        onclick={handlePreviousLastPage}>
                    </lightning-button>
                    <lightning-button variant="brand" 
                        label="Confirm & Send" 
                        onclick={handleSchedule}>
                    </lightning-button>
                            </div>
                </div>

            </div>
        </section>
    </template> 

    <div class="slds-backdrop slds-backdrop_open main-modal-backdrop"></div>

    <template if:true={popUpConfirmPage}>
        <div class="slds-backdrop slds-backdrop_open schedule-modal-backdrop" onclick={handleBackdropClick}></div>
        
        <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="confirm-modal-heading"
            class="slds-modal slds-fade-in-open confirm-modal"
            aria-describedby="modal-content-id-3">
            <div class="slds-modal__container schedule-modal-container">
                <div class="slds-modal__close schedule-close-icon" onclick={handlePreviousLastPage}>
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path
                            d="M2.53317 19.3333L0.666504 17.4667L8.13317 9.99999L0.666504 2.53332L2.53317 0.666656L9.99984 8.13332L17.4665 0.666656L19.3332 2.53332L11.8665 9.99999L19.3332 17.4667L17.4665 19.3333L9.99984 11.8667L2.53317 19.3333Z"
                            fill="white" />
                    </svg>
                </div>

                <div class="slds-modal__header schedule-modal-header">
                    <h2 class="slds-modal__title" id="confirm-modal-heading">Are you sure?</h2>
                </div>

                <div class="slds-modal__content schedule-modal-content" id="modal-content-id-3">
                    <p>Are you sure you want to send this template to the selected contacts?</p>
                    

                    <div class="schedule-modal-footer slds-text-align--center">
                                <lightning-button variant="neutral" 
                        label="Cancel" 
                        onclick={handlePreviousLastPage}>
                    </lightning-button>
                    <lightning-button variant="brand" 
                        label="Confirm & Send" 
                        onclick={handleSendOnPopup}>
                    </lightning-button>
                            </div>
                </div>

            </div>
        </section>
    </template>
    </template>
</template>